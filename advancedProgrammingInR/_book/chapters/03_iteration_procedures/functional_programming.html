<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Functional programming | Advanced Programming in R</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="../../chapters/04_speed_up/SPEED_UP.html" />
    
    
    <link rel="prev" href="../../chapters/03_iteration_procedures/apply.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.3" data-basepath="../.." data-revision="Wed Oct 07 2015 13:39:39 GMT+0200 (CEST)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="chapters/01_structured_workflow/STRUCTURED_WORKFLOW.html">
            
                
                    <a href="../../chapters/01_structured_workflow/STRUCTURED_WORKFLOW.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Towards a structured workflow
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="chapters/01_structured_workflow/projects.html">
            
                
                    <a href="../../chapters/01_structured_workflow/projects.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        RStudio projects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="chapters/01_structured_workflow/version_control.html">
            
                
                    <a href="../../chapters/01_structured_workflow/version_control.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        GitHub version control
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="chapters/02_data_handling/DATA_HANDLING.html">
            
                
                    <a href="../../chapters/02_data_handling/DATA_HANDLING.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Data handling and visualization
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="chapters/02_data_handling/summarizing_data.html">
            
                
                    <a href="../../chapters/02_data_handling/summarizing_data.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Summarizing data
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="chapters/02_data_handling/format_conversions.html">
            
                
                    <a href="../../chapters/02_data_handling/format_conversions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Data format conversions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="chapters/02_data_handling/visualization.html">
            
                
                    <a href="../../chapters/02_data_handling/visualization.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Visualizing data using ggplot2
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="chapters/03_iteration_procedures/ITERATION_PROCEDURES.html">
            
                
                    <a href="../../chapters/03_iteration_procedures/ITERATION_PROCEDURES.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Iteration procedures
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="chapters/03_iteration_procedures/for_loops.html">
            
                
                    <a href="../../chapters/03_iteration_procedures/for_loops.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        for loops
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="chapters/03_iteration_procedures/apply.html">
            
                
                    <a href="../../chapters/03_iteration_procedures/apply.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        The *apply family
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.3" data-path="chapters/03_iteration_procedures/functional_programming.html">
            
                
                    <a href="../../chapters/03_iteration_procedures/functional_programming.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Functional programming
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="chapters/04_speed_up/SPEED_UP.html">
            
                
                    <a href="../../chapters/04_speed_up/SPEED_UP.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Speeding up iteration procedures
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="chapters/04_speed_up/parallelization.html">
            
                
                    <a href="../../chapters/04_speed_up/parallelization.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Parallelization
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="chapters/04_speed_up/rcpp.html">
            
                
                    <a href="../../chapters/04_speed_up/rcpp.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        C++ interconnectivity via Rcpp
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="chapters/05_final_remarks/FINAL_REMARKS.html">
            
                
                    <a href="../../chapters/05_final_remarks/FINAL_REMARKS.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Final remarks
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >Advanced Programming in R</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="functional-programming">Functional programming</h1>
<p>As mentioned in the previous chapter, R is at its core a functional programming language. Put more general, we can say that</p>
<ul>
<li>everything that exists is an object</li>
<li>everything that happens is a function call</li>
</ul>
<h3 id="custom-functions">Custom functions</h3>
<p>The biggest draw-back of point-and-click statistics software is that they are usually limited in the functionality they provide. The provide you with a suite of pre-defined analysis tools and algorithms but usually it is rather tedious to extend these. R on the other hand is a full-blown programming language which means that there are next to no limits to what you can do. One of the most important features to expand existing functionality is to write your own functions. Functions that do not exist elsewhere. In fact, this is the main reason behind R package development.</p>
<p>So, let&apos;s try and create a custom function. A function to calculate the Pythogorean Theorem does not exist in base R. Sure it may exist in some package somewhere, but I argue that it is much easier and quicker to write this yourself.</p>
<pre><code class="lang-r">&gt; pythagoreanTheorem &lt;- <span class="hljs-keyword">function</span>(a, b) {
+   c &lt;- sqrt(a*a + b*b)
+   <span class="hljs-keyword">return</span>(c)
+ }
&gt; 
&gt; pythagoreanTheorem(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
</code></pre>
<pre><code>[1] 5
</code></pre><p>Easy!</p>
<p>Creating custom functions always follows the same procedure:</p>
<ol>
<li>provide a meaningful name and use <code>&lt;-</code> to assign <code>function(x, y, z)</code> where</li>
<li><code>x, y, z</code> are an arbitrary number of named arguments (need not be x, y, z) that are needed for the calculation(s) in the </li>
<li>function body that does all the calculation(s) using the supplied arguments</li>
<li>a <code>return()</code> call to specify what the function will return. If this is not supplied, the result of the last calculation is returned</li>
</ol>
<p>Now it is time for you to try this yourselves.</p>
<h3 id="task-1-write-your-own">Task #1: write your own</h3>
<p>In R we can easily calculate a pupolations standard deviation around the the mean using <code>sd()</code> but there is no default implementation for the <a href="https://en.wikipedia.org/wiki/Standard_error" target="_blank">standard error of the mean</a>. Therefore, it is up to you to write one now. </p>
<p>Note, there are far more standard error statistics for which R does not provide standard base functions, such as the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation" target="_blank">root mean square error RMSE</a> or the <a href="https://en.wikipedia.org/wiki/Approximation_error" target="_blank">absolute error AE</a>. Therefore, if you&apos;re keen go ahead and practice writing functions to provide these.</p>
<center>
  <img src="https://pixabay.com/static/uploads/photo/2012/04/14/14/04/hourglass-34048_640.png" alt="hourglass" style="width: 200px;">
</center>

<hr>
<h3 id="functionals">Functionals</h3>
<p>We&apos;ve already seen functionals, functions that take other functions as arguments. However, so far we&apos;ve only used these with standard base R functions. But we can also supply a custom function to a functional.</p>
<pre><code class="lang-r">&gt; dat &lt;- data.frame(a = c(<span class="hljs-number">3</span>, <span class="hljs-number">7</span>, <span class="hljs-number">11</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">2</span>),
+                   b = c(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5</span>))
&gt; 
&gt; sapply(seq(nrow(dat)), <span class="hljs-keyword">function</span>(i) pythagoreanTheorem(dat[i, <span class="hljs-number">1</span>], dat[i, <span class="hljs-number">2</span>]))
</code></pre>
<pre><code>[1]  5.000000  7.615773 11.180340  3.162278 26.832816  5.385165
</code></pre><p>Given that R comes equipped with a great variety of <code>*apply()</code> functionals, it is usually not necessary to write a functional yourself. </p>
<hr>
<h3 id="closures">Closures</h3>
<p>The counterpart to functionals are so-called closures. These are functions that return (or build) a function according to some supplied argument. To illustrate this, let&apos;s consider the following situation:</p>
<p>We have a bunch of possible predictor variables and a bunch of response variables and we want to figure out the best combination in explaining the variances. </p>
<pre><code class="lang-r">&gt; <span class="hljs-comment">### generate some random data</span>
&gt; set.seed(<span class="hljs-number">123</span>)
&gt; pred &lt;- data.frame(pred1 = rnorm(<span class="hljs-number">100</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>),
+                    pred2 = <span class="hljs-number">1</span>:<span class="hljs-number">100</span>,
+                    pred3 = rpois(<span class="hljs-number">100</span>, <span class="hljs-number">2</span>),
+                    pred4 = <span class="hljs-number">200</span>:<span class="hljs-number">101</span>)
&gt; 
&gt; set.seed(<span class="hljs-number">234</span>)
&gt; resp &lt;- data.frame(resp1 = <span class="hljs-number">1</span>:<span class="hljs-number">100</span>,
+                    resp2 = rnorm(<span class="hljs-number">100</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>),
+                    resp3 = <span class="hljs-number">200</span>:<span class="hljs-number">101</span>,
+                    resp4 = rpois(<span class="hljs-number">100</span>, <span class="hljs-number">2</span>))
</code></pre>
<p>We could simply use copy and paste to claculate each combination.</p>
<pre><code class="lang-r">&gt; summary(lm(resp$resp1 ~ pred$pred1))$r.squared
&gt; summary(lm(resp$resp2 ~ pred$pred1))$r.squared
&gt; summary(lm(resp$resp2 ~ pred$pred1))$r.squared
&gt; summary(lm(resp$resp4 ~ pred$pred1))$r.squared
&gt; 
&gt; summary(lm(resp$resp1 ~ pred$pred2))$r.squared
&gt; summary(lm(resp$resp2 ~ pred$pred2))$r.squared
&gt; summary(lm(resp$resp3 ~ pred$pred2))$r.squared
&gt; summary(lm(resp$resp4 ~ pred$pred3))$r.squared
&gt; 
&gt; <span class="hljs-comment">#.... and so forth</span>
</code></pre>
<p>This is far from being optimal. Despite the fact that we have to type a lot, we are very prone to introduce errors (can you spot them?) and it is particularly hard to debug. Here, defining a closure can be of great help.</p>
<pre><code class="lang-r">&gt; <span class="hljs-comment">### define closure</span>
&gt; calcRsq &lt;- <span class="hljs-keyword">function</span>(pred) {
+ 
+   <span class="hljs-keyword">function</span>(y) {
+     summary(lm(y ~ pred))$r.squared
+   }
+ 
+ }
</code></pre>
<p>We now have a universal way of defining functions to calculate R-squared values</p>
<pre><code class="lang-r">&gt; <span class="hljs-comment">## create function using pred$v1 as predictor</span>
&gt; calcRsq_pred1 &lt;- calcRsq(pred$pred1)
&gt; 
&gt; calcRsq_pred1(resp$resp1)
</code></pre>
<pre><code>[1] 0.006369369
</code></pre><p>Using it explicitly like above doesn&apos;t really help us much, although we have made sure to not introduce any errors related to the respective predictor being used as this is now fixed within the function <code>calcRsq_pred1()</code>. However, given that we now have a function which calculates the R-squared value between a fixed predictor and whatever response we give it, we can now use a functional such as <code>apply()</code> to calculate the relationship between the predictor and a bunch of responses.</p>
<pre><code class="lang-r">&gt; apply(resp, <span class="hljs-number">2</span>, calcRsq_pred1)
</code></pre>
<pre><code>      resp1       resp2       resp3       resp4 
0.006369369 0.012977823 0.006369369 0.038727184
</code></pre><p>But why stop here, taking advantage of <code>sapply()</code> we can calculate every possible combination in one go.</p>
<pre><code class="lang-r">&gt; sapply(seq(ncol(pred)), <span class="hljs-keyword">function</span>(i) {
+   f &lt;- calcRsq(pred[, i])
+   apply(resp, <span class="hljs-number">2</span>, f)
+ })
</code></pre>
<pre><code>             [,1]        [,2]        [,3]        [,4]
resp1 0.006369369 1.000000000 0.006326898 1.000000000
resp2 0.012977823 0.012414970 0.006192994 0.012414970
resp3 0.006369369 1.000000000 0.006326898 1.000000000
resp4 0.038727184 0.002312083 0.007719519 0.002312083
</code></pre><p>In words, we </p>
<ol>
<li>iterate over the columns of pred - <code>seq(ncol(pred))</code></li>
<li>define a function <code>f</code> by setting the closure to use the column of the current iteration - <code>f &lt;- calcRsq(pred[, i])</code></li>
<li>apply this function <code>f</code> to all columns of resp - <code>apply(resp, 2, f)</code></li>
</ol>
<p>The result is equivalent to what <code>cor(resp, pred)</code> produces.</p>
<pre><code class="lang-r">&gt; cor(resp, pred)^<span class="hljs-number">2</span>
</code></pre>
<pre><code>            pred1       pred2       pred3       pred4
resp1 0.006369369 1.000000000 0.006326898 1.000000000
resp2 0.012977823 0.012414970 0.006192994 0.012414970
resp3 0.006369369 1.000000000 0.006326898 1.000000000
resp4 0.038727184 0.002312083 0.007719519 0.002312083
</code></pre><p>So you see that the combination of functionals and closures is a powerful, flexible and elegant way of generalising computations. In fact, it is so flexible that we can now use the same functions for any data frames.</p>
<pre><code class="lang-r">&gt; df1 &lt;- diamonds[, c(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)]
&gt; df2 &lt;- diamonds[, <span class="hljs-number">7</span>:<span class="hljs-number">10</span>]
&gt; 
&gt; sapply(seq(ncol(df1)), <span class="hljs-keyword">function</span>(i) {
+   f &lt;- calcRsq(df1[, i])
+   apply(df2, <span class="hljs-number">2</span>, f)
+ })
</code></pre>
<pre><code>           [,1]         [,2]       [,3]
price 0.8493305 0.0001133672 0.01616303
x     0.9508088 0.0006395460 0.03815939
y     0.9057751 0.0008608750 0.03376779
z     0.9089475 0.0090105434 0.02277947
</code></pre><p>This is especially valuable for large calculations that require iterating over a set of objects. A classic scenario for using closures in combination with functionals is to find a &apos;best&apos; value, i.e. some parameter that optimises a fit or something along those lines.</p>
<p>A very detailed tutorial on how to use functional programming in R can be found in Hadley Wickham&apos;s book <a href="http://adv-r.had.co.nz/Functional-programming.html" target="_blank">Advanced R</a>. This goes quite a bit deeper than what is outlined here and has a rather neat example of how to use functional programming to flexibly deal with encodings for missing data (e.g. -99, -999, -9999, ...).</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../chapters/03_iteration_procedures/apply.html" class="navigation navigation-prev " aria-label="Previous page: The *apply family"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../chapters/04_speed_up/SPEED_UP.html" class="navigation navigation-next " aria-label="Next page: Speeding up iteration procedures"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
